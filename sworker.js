(()=>{"stream"in Blob.prototype||Object.defineProperty(Blob.prototype,"stream",{value(){return new Response(this).body}});"setBigUint64"in DataView.prototype||Object.defineProperty(DataView.prototype,"setBigUint64",{value(e,n,t){let r=Number(n&0xffffffffn),s=Number(n>>32n);this.setUint32(e+(t?0:4),r,t),this.setUint32(e+(t?4:0),s,t)}});var c=e=>new DataView(new ArrayBuffer(e)),f=e=>new Uint8Array(e.buffer||e),u=e=>Math.min(4294967295,Number(e)),y=e=>Math.min(65535,Number(e));function d(e,n,t){if(n!==void 0&&!(n instanceof Uint8Array)&&(n=l(n)),t!==void 0&&!(t instanceof Date)&&(t=new Date(t)),e instanceof File)return{encodedName:n||l(e.name),modDate:t||new Date(e.lastModified),bytes:e.stream()};if(e instanceof Response){let r=e.headers.get("content-disposition"),s=r&&r.match(/;\s*filename\*?=["']?(.*?)["']?$/i),a=s&&s[1]||new URL(e.url).pathname.split("/").pop(),o=a&&decodeURIComponent(a);return{encodedName:n||l(o),modDate:t||new Date(e.headers.get("Last-Modified")||Date.now()),bytes:e.body}}if(!n||n.length===0)throw new Error("The file must have a name.");if(t===void 0)t=new Date;else if(isNaN(t))throw new Error("Invalid modification date.");if(typeof e=="string")return{encodedName:n,modDate:t,bytes:l(e)};if(e instanceof Blob)return{encodedName:n,modDate:t,bytes:e.stream()};if(e instanceof Uint8Array||e instanceof ReadableStream)return{encodedName:n,modDate:t,bytes:e};if(e instanceof ArrayBuffer||ArrayBuffer.isView(e))return{encodedName:n,modDate:t,bytes:f(e)};if(Symbol.asyncIterator in e)return{encodedName:n,modDate:t,bytes:m(e)};throw new TypeError("Unsupported input format.")}function m(e){let n="next"in e?e:e[Symbol.asyncIterator]();return new ReadableStream({async pull(t){let r=0;for(;t.desiredSize>r;){let s=await n.next();if(s.value){let a=R(s.value);t.enqueue(a),r+=a.byteLength}else{t.close();break}}}})}function R(e){return typeof e=="string"?l(e):e instanceof Uint8Array?e:f(e)}function l(e){return new TextEncoder().encode(String(e))}var k="AGFzbQEAAAABCgJgAABgAn9/AXwDAwIAAQUDAQACBw0DAW0CAAF0AAABYwABCpUBAkkBA38DQCABIQBBACECA0AgAEEBdiAAQQFxQaCG4u1+bHMhACACQQFqIgJBCEcNAAsgAUECdCAANgIAIAFBAWoiAUGAAkcNAAsLSQEBfyABQX9zIQFBgIAEIQJBgIAEIABqIQADQCABQf8BcSACLQAAc0ECdCgCACABQQh2cyEBIAJBAWoiAiAASQ0ACyABQX9zuAs",L=new WebAssembly.Instance(new WebAssembly.Module(Uint8Array.from(atob(k),e=>e.charCodeAt(0)))),{t:E,c:_,m:Q}=L.exports;E();var g=65536,P=f(Q).subarray(g);function b(e,n=0){for(let t of W(e))P.set(t),n=_(t.length,n);return n}function*W(e){for(;e.length>g;)yield e.subarray(0,g),e=e.subarray(g);e.length&&(yield e)}function A(e,n,t=0){let r=e.getSeconds()>>1|e.getMinutes()<<5|e.getHours()<<11,s=e.getDate()|e.getMonth()+1<<5|e.getFullYear()-1980<<9;n.setUint16(t,r,!0),n.setUint16(t+2,s,!0)}var T=1347093252,B=30,Z=1347094280,x=16,H=1347092738,N=46,j=1347093766,q=22,h=28,V=1347094022,F=56,O=1347094023,$=20;async function*S(e){let n=[],t=0n,r=0n,s=!1;for await(let i of e){yield G(i),yield i.encodedName,yield*J(i);let p=i.uncompressedSize>=0xffffffffn||t>=0xffffffffn;yield X(i,p),n.push(Y(i,t,p)),n.push(i.encodedName),p&&(n.push(K(i,t)),t+=8n),r++,t+=BigInt(B+x+i.encodedName.length)+i.uncompressedSize,s||(s=p)}let a=0n;for(let i of n)yield i,a+=BigInt(i.length);if(s||t>=0xffffffffn){let i=c(F+$);i.setUint32(0,V),i.setBigUint64(4,BigInt(F-12),!0),i.setUint32(12,755182848),i.setBigUint64(24,r,!0),i.setBigUint64(32,r,!0),i.setBigUint64(40,a,!0),i.setBigUint64(48,t,!0),i.setUint32(56,O),i.setBigUint64(64,t+a,!0),i.setUint32(72,1,!0),yield f(i)}let o=c(q);o.setUint32(0,j),o.setUint16(8,y(r),!0),o.setUint16(10,y(r),!0),o.setUint32(12,u(a),!0),o.setUint32(16,u(t),!0),yield f(o)}function G(e){let n=c(B);return n.setUint32(0,T),n.setUint32(4,754976768),A(e.modDate,n,10),n.setUint16(26,e.encodedName.length,!0),f(n)}async function*J(e){let{bytes:n}=e;if("then"in n&&(n=await n),n instanceof Uint8Array)yield n,e.crc=b(n,0),e.uncompressedSize=BigInt(n.length);else{e.uncompressedSize=0n;let t=n.getReader();for(;;){let{value:r,done:s}=await t.read();if(s)break;e.crc=b(r,e.crc),e.uncompressedSize+=BigInt(r.length),yield r}}}function X(e,n){let t=c(x+(n?8:0));return t.setUint32(0,Z),t.setUint32(4,e.crc,!0),n?(t.setBigUint64(8,e.uncompressedSize,!0),t.setBigUint64(16,e.uncompressedSize,!0)):(t.setUint32(8,u(e.uncompressedSize),!0),t.setUint32(12,u(e.uncompressedSize),!0)),f(t)}function Y(e,n,t){let r=c(N);return r.setUint32(0,H),r.setUint32(4,755182848),r.setUint16(8,2048),A(e.modDate,r,12),r.setUint32(16,e.crc,!0),r.setUint32(20,u(e.uncompressedSize),!0),r.setUint32(24,u(e.uncompressedSize),!0),r.setUint16(28,e.encodedName.length,!0),r.setUint16(30,t?h:0,!0),r.setUint16(40,33204,!0),r.setUint32(42,u(n),!0),f(r)}function K(e,n){let t=c(h);return t.setUint16(0,1,!0),t.setUint16(2,h-4,!0),t.setBigUint64(4,e.uncompressedSize,!0),t.setBigUint64(12,e.uncompressedSize,!0),t.setBigUint64(20,n,!0),f(t)}async function*ee(e){for await(let n of e)n instanceof File||n instanceof Response?yield d(n):yield d(n.input,n.name,n.lastModified)}var D=(e,n={headers:{"Content-Type":"application/zip","Content-Disposition":"attachment"}})=>new Response(m(S(ee(e))),n);function C(e){return e?e.type==="result_message"&&typeof e.id=="string"&&!!e.files:!1}self.addEventListener("install",te);self.addEventListener("activate",ne);self.addEventListener("fetch",re);self.addEventListener("message",ie);var I=new Map;function te(e){console.log("[sworker] install"),e.waitUntil(self.skipWaiting())}function ne(e){console.log("[sworker] activate"),e.waitUntil(self.clients.claim())}function re(e){var w;if(e.request.method.toUpperCase()!=="GET")return;let{href:t,protocol:r,host:s}=location,a=t.indexOf("/sworker.js"),o=`${r}//${s}`;if(!t.startsWith(o)||a<o.length)return;let i=t.substring(o.length,a),p=new URL(e.request.url);if(!p.href.startsWith(o))return;let U=p.pathname,M=i===""?"/dl/":`${i}/dl/`;if(!U.startsWith(M))return;let v=U.substring(M.length);if(p.searchParams.get("action")==="download"){let z=(w=p.searchParams.get("filename"))!=null?w:"world.mcworld";e.respondWith(oe(v,z))}}function ie(e){if(C(e.data)){let{id:n,files:t}=e.data;I.set(n,t)}}async function*se(e,n){for(let t of e){let[r,s]=t,o=await(await fetch(s)).blob();yield new File([o],r.substring(n.length))}}async function oe(e,n){var s;let t=I.get(e);if(((s=t==null?void 0:t.length)!=null?s:0)===0)return new Response(null,{status:404});let r=`/je2be/${e}/out/`;return D(se(t,r),{headers:{"Content-Type":"application/octet-stream","Cache-Control":"no-cache","Content-Disposition":`attachment; filename="${n}"`}})}})();
