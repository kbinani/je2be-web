(()=>{"stream"in Blob.prototype||Object.defineProperty(Blob.prototype,"stream",{value(){return new Response(this).body}});"setBigUint64"in DataView.prototype||Object.defineProperty(DataView.prototype,"setBigUint64",{value(e,n,t){let r=Number(n&0xffffffffn),i=Number(n>>32n);this.setUint32(e+(t?0:4),r,t),this.setUint32(e+(t?4:0),i,t)}});var c=e=>new DataView(new ArrayBuffer(e)),f=e=>new Uint8Array(e.buffer||e),u=e=>Math.min(4294967295,Number(e)),y=e=>Math.min(65535,Number(e));function d(e,n,t){if(n!==void 0&&!(n instanceof Uint8Array)&&(n=l(n)),t!==void 0&&!(t instanceof Date)&&(t=new Date(t)),e instanceof File)return{encodedName:n||l(e.name),modDate:t||new Date(e.lastModified),bytes:e.stream()};if(e instanceof Response){let r=e.headers.get("content-disposition"),i=r&&r.match(/;\s*filename\*?=["']?(.*?)["']?$/i),a=i&&i[1]||new URL(e.url).pathname.split("/").pop(),o=a&&decodeURIComponent(a);return{encodedName:n||l(o),modDate:t||new Date(e.headers.get("Last-Modified")||Date.now()),bytes:e.body}}if(!n||n.length===0)throw new Error("The file must have a name.");if(t===void 0)t=new Date;else if(isNaN(t))throw new Error("Invalid modification date.");if(typeof e=="string")return{encodedName:n,modDate:t,bytes:l(e)};if(e instanceof Blob)return{encodedName:n,modDate:t,bytes:e.stream()};if(e instanceof Uint8Array||e instanceof ReadableStream)return{encodedName:n,modDate:t,bytes:e};if(e instanceof ArrayBuffer||ArrayBuffer.isView(e))return{encodedName:n,modDate:t,bytes:f(e)};if(Symbol.asyncIterator in e)return{encodedName:n,modDate:t,bytes:m(e)};throw new TypeError("Unsupported input format.")}function m(e){let n="next"in e?e:e[Symbol.asyncIterator]();return new ReadableStream({async pull(t){let r=0;for(;t.desiredSize>r;){let i=await n.next();if(i.value){let a=k(i.value);t.enqueue(a),r+=a.byteLength}else{t.close();break}}}})}function k(e){return typeof e=="string"?l(e):e instanceof Uint8Array?e:f(e)}function l(e){return new TextEncoder().encode(String(e))}var L="AGFzbQEAAAABCgJgAABgAn9/AXwDAwIAAQUDAQACBw0DAW0CAAF0AAABYwABCpUBAkkBA38DQCABIQBBACECA0AgAEEBdiAAQQFxQaCG4u1+bHMhACACQQFqIgJBCEcNAAsgAUECdCAANgIAIAFBAWoiAUGAAkcNAAsLSQEBfyABQX9zIQFBgIAEIQJBgIAEIABqIQADQCABQf8BcSACLQAAc0ECdCgCACABQQh2cyEBIAJBAWoiAiAASQ0ACyABQX9zuAs",_=new WebAssembly.Instance(new WebAssembly.Module(Uint8Array.from(atob(L),e=>e.charCodeAt(0)))),{t:E,c:Q,m:P}=_.exports;E();var g=65536,W=f(P).subarray(g);function b(e,n=0){for(let t of T(e))W.set(t),n=Q(t.length,n);return n}function*T(e){for(;e.length>g;)yield e.subarray(0,g),e=e.subarray(g);e.length&&(yield e)}function A(e,n,t=0){let r=e.getSeconds()>>1|e.getMinutes()<<5|e.getHours()<<11,i=e.getDate()|e.getMonth()+1<<5|e.getFullYear()-1980<<9;n.setUint16(t,r,!0),n.setUint16(t+2,i,!0)}var Z=1347093252,F=30,H=1347094280,x=16,N=1347092738,j=46,q=1347093766,V=22,h=28,O=1347094022,S=56,$=1347094023,G=20;async function*D(e){let n=[],t=0n,r=0n,i=!1;for await(let s of e){yield J(s),yield s.encodedName,yield*X(s);let p=s.uncompressedSize>=0xffffffffn||t>=0xffffffffn;yield Y(s,p),n.push(K(s,t,p)),n.push(s.encodedName),p&&(n.push(ee(s,t)),t+=8n),r++,t+=BigInt(F+x+s.encodedName.length)+s.uncompressedSize,i||(i=p)}let a=0n;for(let s of n)yield s,a+=BigInt(s.length);if(i||t>=0xffffffffn){let s=c(S+G);s.setUint32(0,O),s.setBigUint64(4,BigInt(S-12),!0),s.setUint32(12,755182848),s.setBigUint64(24,r,!0),s.setBigUint64(32,r,!0),s.setBigUint64(40,a,!0),s.setBigUint64(48,t,!0),s.setUint32(56,$),s.setBigUint64(64,t+a,!0),s.setUint32(72,1,!0),yield f(s)}let o=c(V);o.setUint32(0,q),o.setUint16(8,y(r),!0),o.setUint16(10,y(r),!0),o.setUint32(12,u(a),!0),o.setUint32(16,u(t),!0),yield f(o)}function J(e){let n=c(F);return n.setUint32(0,Z),n.setUint32(4,754976768),A(e.modDate,n,10),n.setUint16(26,e.encodedName.length,!0),f(n)}async function*X(e){let{bytes:n}=e;if("then"in n&&(n=await n),n instanceof Uint8Array)yield n,e.crc=b(n,0),e.uncompressedSize=BigInt(n.length);else{e.uncompressedSize=0n;let t=n.getReader();for(;;){let{value:r,done:i}=await t.read();if(i)break;e.crc=b(r,e.crc),e.uncompressedSize+=BigInt(r.length),yield r}}}function Y(e,n){let t=c(x+(n?8:0));return t.setUint32(0,H),t.setUint32(4,e.crc,!0),n?(t.setBigUint64(8,e.uncompressedSize,!0),t.setBigUint64(16,e.uncompressedSize,!0)):(t.setUint32(8,u(e.uncompressedSize),!0),t.setUint32(12,u(e.uncompressedSize),!0)),f(t)}function K(e,n,t){let r=c(j);return r.setUint32(0,N),r.setUint32(4,755182848),r.setUint16(8,2048),A(e.modDate,r,12),r.setUint32(16,e.crc,!0),r.setUint32(20,u(e.uncompressedSize),!0),r.setUint32(24,u(e.uncompressedSize),!0),r.setUint16(28,e.encodedName.length,!0),r.setUint16(30,t?h:0,!0),r.setUint16(40,33204,!0),r.setUint32(42,u(n),!0),f(r)}function ee(e,n){let t=c(h);return t.setUint16(0,1,!0),t.setUint16(2,h-4,!0),t.setBigUint64(4,e.uncompressedSize,!0),t.setBigUint64(12,e.uncompressedSize,!0),t.setBigUint64(20,n,!0),f(t)}async function*te(e){for await(let n of e)n instanceof File||n instanceof Response?yield d(n):yield d(n.input,n.name,n.lastModified)}var C=(e,n={headers:{"Content-Type":"application/zip","Content-Disposition":"attachment"}})=>new Response(m(D(te(e))),n);function I(e){return e?e.type==="result_message"&&typeof e.id=="string"&&!!e.files:!1}function v(e){return e?e.type==="forget_result_files"&&typeof e.id=="string":!1}self.addEventListener("install",ne);self.addEventListener("activate",re);self.addEventListener("fetch",se);self.addEventListener("message",ie);var U=new Map;function ne(e){console.log("[sworker] install"),e.waitUntil(self.skipWaiting())}function re(e){console.log("[sworker] activate"),e.waitUntil(self.clients.claim())}function se(e){var B;if(e.request.method.toUpperCase()!=="GET")return;let{href:t,protocol:r,host:i}=location,a=t.indexOf("/sworker.js"),o=`${r}//${i}`;if(!t.startsWith(o)||a<o.length)return;let s=t.substring(o.length,a),p=new URL(e.request.url);if(!p.href.startsWith(o))return;let M=p.pathname,w=s===""?"/dl/":`${s}/dl/`;if(!M.startsWith(w))return;let R=M.substring(w.length);if(p.searchParams.get("action")==="download"){let z=(B=p.searchParams.get("filename"))!=null?B:"world.mcworld";e.respondWith(ae(R,z))}}function ie(e){let n=e.data;if(I(n)){let{id:t,files:r}=n;U.set(t,r)}else if(v(n)){let{id:t}=n;U.delete(t)}}async function*oe(e,n){for(let t of e){let[r,i]=t,o=await(await fetch(i)).blob();yield new File([o],r.substring(n.length))}}async function ae(e,n){var i;let t=U.get(e);if(((i=t==null?void 0:t.length)!=null?i:0)===0)return new Response(null,{status:404});let r=`/je2be/${e}/out/`;return C(oe(t,r),{headers:{"Content-Type":"application/octet-stream","Cache-Control":"no-cache","Content-Disposition":`attachment; filename="${n}"`}})}})();
